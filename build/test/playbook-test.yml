---
- hosts: all
  become: false
  vars: 
  - images:
    - name: "nms-db-test"
      links: []
    - name: "nms-front-test"
      links: [ "nms-db-test:db" ]
    - name: "nms-varnish-test"
      links: [ "nms-front-test:nms-front" ]
    - name: "nms-collector-test"
      links: [ "nms-db-test:db" ]

  tasks:
  - name: make all
    docker_image:
        state: build
        name: "{{ item.name }}"
        docker_api_version: 1.18
        dockerfile: test/{{ item.name }}.Dockerfile
        path: "src/tgnms/build/"
    with_items: "{{ images }}"

  - name: stop all
    docker:
        name: "{{ item.name }}"
        state: stopped
        image: "{{ item.name }}"
        docker_api_version: 1.18
    with_items: "{{ images }}"

  - name: start all
    docker: 
        name: "{{ item.name }}"
        image: "{{ item.name }}"
        docker_api_version: 1.18
        state: started
        net: bridge
        links: "{{ item.links  }}"
    with_items: "{{ images }}"


